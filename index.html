<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Subic Ibaba Eco Action</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

<style>
* { box-sizing: border-box; }

body {
    margin: 0;
    font-family: "Trebuchet MS", Arial, sans-serif;
    background: #eef5ea;
}

/* HEADER */
header {
    background: linear-gradient(180deg, #6fbf73, #4c9a58);
    color: white;
    text-align: center;
    padding: 25px;
    font-size: 36px;
    font-weight: bold;
    border-bottom: 6px solid #3d7f46;
}

/* DASHBOARD GRID */
#dashboard {
    display: grid;
    grid-template-columns: 3fr 2fr;
    gap: 20px;
    padding: 20px;
}

/* PLANNING BOARD */
#planning {
    display: flex;
    gap: 15px;
    grid-column: 1 / span 2;
}

.quarter {
    background: #fffdf4;
    border-radius: 12px;
    padding: 12px;
    width: 100%;
    border: 3px solid #d9c9a3;
    box-shadow: 0 6px 0 #cbb98b;
}

.quarter h3 {
    text-align: center;
    background: #8b5a2b;
    color: white;
    padding: 6px;
    border-radius: 6px;
    font-size: 14px;
    margin-bottom: 10px;
}

/* NOTES */
.note {
    height: 60px;
    border-radius: 6px;
    margin-bottom: 10px;
    box-shadow: 2px 3px 0 rgba(0,0,0,0.2);
}
.yellow { background: #f3d45c; }
.green { background: #7fcf8a; }
.blue { background: #9ed0f6; }

/* Editable notes */
.note[contenteditable="true"] {
    border: 2px dashed #c0392b;
    cursor: text;
}

/* VOLUNTEER TABLE */
table {
    width: 100%;
    border-collapse: collapse;
    background: #fffdf4;
    border-radius: 12px;
    overflow: hidden;
    border: 3px solid #d9c9a3;
}

th {
    background: #4c9a58;
    color: white;
    padding: 10px;
}

td {
    border: 1px solid #d9c9a3;
    padding: 5px;
}

td button {
    background: #c0392b;
    color: white;
    border: none;
    padding: 5px 10px;
    border-radius: 6px;
    cursor: pointer;
}

td button:hover {
    background: #922b21;
}

/* RIGHT PANEL */
#rightPanel {
    display: flex;
    flex-direction: column;
    gap: 20px;
}

/* MAP */
#map {
    height: 250px;
    border-radius: 12px;
    border: 4px solid #6fa76f;
    box-shadow: 0 5px 0 #4c7c4c;
}

/* UPDATES */
#updates {
    display: flex;
    gap: 10px;
}

#updates .label {
    background: #f3d45c;
    padding: 12px;
    font-weight: bold;
    border-radius: 8px;
}

#updates .content {
    background: #fffdf4;
    flex: 1;
    border-radius: 8px;
    padding: 12px;
    border: 2px solid #d9c9a3;
}

/* Editable updates */
#updates .content[contenteditable="true"] {
    border: 2px dashed #c0392b;
    cursor: text;
}

/* FORM */
#form {
    background: #fffdf4;
    padding: 15px;
    border-radius: 12px;
    border: 3px solid #d9c9a3;
}

button.submit {
    background: #4c9a58;
    color: white;
    font-weight: bold;
    padding: 10px;
    border-radius: 6px;
}
</style>
</head>

<body>

<header>Subic Ibaba Eco Action</header>

<div id="dashboard">

<!-- SCHEDULE -->
<div id="planning">
    <div class="quarter"><h3>JAN–MAR</h3><div class="note yellow"></div><div class="note blue"></div><div class="note green"></div></div>
    <div class="quarter"><h3>APR–JUNE</h3><div class="note green"></div><div class="note yellow"></div><div class="note blue"></div></div>
    <div class="quarter"><h3>JULY–SEPT</h3><div class="note blue"></div><div class="note green"></div><div class="note yellow"></div></div>
    <div class="quarter"><h3>OCT–DEC</h3><div class="note green"></div><div class="note yellow"></div><div class="note blue"></div></div>
</div>

<!-- VOLUNTEER TABLE BELOW SCHEDULE -->
<div style="grid-column:1 / span 2;">
<table id="volunteerTable">
<tr><th>Name</th><th>Contact</th><th>Availability</th><th>Action</th></tr>
</table>
</div>

<!-- RIGHT PANEL -->
<div id="rightPanel">
    <div id="map"></div>

    <div id="updates">
        <div class="label">GENERAL UPDATES</div>
        <div class="content">Latest updates about Agoncillo, Batangas will appear here. Example: Community clean-up schedule, announcements, or local news.</div>
    </div>

    <div id="form">
        <h3>Volunteer Sign-Up</h3>
        <form id="signupForm">
            <input id="name" placeholder="Name" required>
            <input id="contact" placeholder="Contact" required>
            <textarea id="availability" placeholder="Availability" required></textarea>
            <button class="submit">Add Volunteer</button>
        </form>
        <p id="msg"></p>
    </div>
</div>

</div>

<!-- LEAFLET SCRIPT -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

/* ELEMENT REFERENCES */
const table = document.getElementById("volunteerTable");
const form = document.getElementById("signupForm");
const inputName = document.getElementById("name");
const inputContact = document.getElementById("contact");
const inputAvailability = document.getElementById("availability");
const notes = document.querySelectorAll(".note");
const updatesContent = document.querySelector("#updates .content");

/* MAP */
const map = L.map('map').setView([13.9360, 120.9250], 15);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
L.polygon([[13.9375,120.9235],[13.9375,120.9275],[13.9345,120.9275],[13.9345,120.9235]],{
    color:'red', fillColor:'#f56565', fillOpacity:0.6
}).addTo(map).bindPopup("Needs Cleaning");

/* REAL-TIME SCHEDULE SYNC */
notes.forEach((note, idx) => {
    note.setAttribute("contenteditable", "true");
    note.addEventListener("blur", async () => {
        const noteRef = doc(db, "schedule", `note${idx}`);
        await updateDoc(noteRef, { content: note.innerText }).catch(async () => {
            await addDoc(collection(db, "schedule"), { id: `note${idx}`, content: note.innerText });
        });
    });
});

onSnapshot(collection(db, "schedule"), snapshot => {
    snapshot.forEach(docSnap => {
        const idx = parseInt(docSnap.id.replace("note",""));
        if (notes[idx]) notes[idx].innerText = docSnap.data().content;
    });
});

/* VOLUNTEER TABLE */
onSnapshot(collection(db, "volunteers"), snapshot => {
    table.innerHTML = `
      <tr>
        <th>Name</th>
        <th>Contact</th>
        <th>Availability</th>
        <th>Action</th>
      </tr>`;
    snapshot.forEach(docSnap => addRow(docSnap));
});

form.addEventListener("submit", async e => {
    e.preventDefault();
    if (!inputName.value || !inputContact.value || !inputAvailability.value) return;
    await addDoc(collection(db, "volunteers"), {
        name: inputName.value,
        contact: inputContact.value,
        availability: inputAvailability.value
    });
    form.reset();
});

function addRow(docSnap){
    const v = docSnap.data();
    const r = table.insertRow();
    r.insertCell().innerText = v.name;
    r.insertCell().innerText = v.contact;
    r.insertCell().innerText = v.availability;

    const c = r.insertCell();
    const b = document.createElement("button");
    b.innerText = "Delete";
    b.onclick = () => deleteDoc(doc(db, "volunteers", docSnap.id));
    c.appendChild(b);
}

/* GENERAL UPDATES ABOUT AGONCILLO - editable */
updatesContent.setAttribute("contenteditable", "true");
updatesContent.addEventListener("blur", async () => {
    const updatesRef = doc(db, "generalUpdates", "agoncillo");
    await updateDoc(updatesRef, { content: updatesContent.innerText }).catch(async () => {
        await addDoc(collection(db, "generalUpdates"), { id: "agoncillo", content: updatesContent.innerText });
    });
});

// Load updates from Firestore
onSnapshot(collection(db, "generalUpdates"), snapshot => {
    snapshot.forEach(docSnap => {
        if(docSnap.id === "agoncillo") {
            updatesContent.innerText = docSnap.data().content;
        }
    });
});
</script>

</body>
</html>

