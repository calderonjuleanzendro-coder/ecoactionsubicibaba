<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Subic Ibaba Eco Action</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

<style>
* { box-sizing: border-box; }

body {
    margin: 0;
    font-family: "Trebuchet MS", Arial, sans-serif;
    background: #eef5ea;
}

header {
    background: linear-gradient(180deg, #6fbf73, #4c9a58);
    color: white;
    text-align: center;
    padding: 25px;
    font-size: 36px;
    font-weight: bold;
}

#dashboard {
    display: grid;
    grid-template-columns: 3fr 2fr;
    gap: 20px;
    padding: 20px;
}

#planning {
    display: flex;
    gap: 15px;
    grid-column: 1 / span 2;
}

.quarter {
    background: #fffdf4;
    border-radius: 12px;
    padding: 12px;
    width: 100%;
}

.note {
    height: 60px;
    border-radius: 6px;
    margin-bottom: 10px;
}
.yellow { background: #f3d45c; }
.green { background: #7fcf8a; }
.blue { background: #9ed0f6; }

table {
    width: 100%;
    border-collapse: collapse;
    background: #fffdf4;
}

th {
    background: #4c9a58;
    color: white;
    padding: 10px;
}

td {
    border: 1px solid #ccc;
    padding: 5px;
}

#rightPanel {
    display: flex;
    flex-direction: column;
    gap: 20px;
}

#map {
    height: 250px;
}

#updates {
    display: flex;
    gap: 10px;
}

#updates .content {
    background: #fffdf4;
    flex: 1;
    padding: 12px;
}

#form {
    background: #fffdf4;
    padding: 15px;
}

button.submit {
    background: #4c9a58;
    color: white;
    font-weight: bold;
    padding: 10px;
}
</style>
</head>

<body>

<header>Subic Ibaba Eco Action</header>

<div id="dashboard">

<div id="planning">
    <div class="quarter"><h3>JAN–MAR</h3><div class="note yellow"></div></div>
    <div class="quarter"><h3>APR–JUNE</h3><div class="note green"></div></div>
    <div class="quarter"><h3>JULY–SEPT</h3><div class="note blue"></div></div>
    <div class="quarter"><h3>OCT–DEC</h3><div class="note yellow"></div></div>
</div>

<div style="grid-column:1 / span 2;">
<table id="volunteerTable">
<tr><th>Name</th><th>Contact</th><th>Availability</th><th>Action</th></tr>
</table>
</div>

<div id="rightPanel">
    <div id="map"></div>

    <div id="updates">
        <div class="content">General Updates...</div>
    </div>

    <div id="form">
        <h3>Volunteer Sign-Up</h3>
        <form id="signupForm">
            <input id="name" placeholder="Name" required>
            <input id="contact" placeholder="Contact" required>
            <textarea id="availability" placeholder="Availability" required></textarea>
            <button class="submit" type="submit">Add Volunteer</button>
        </form>
    </div>
</div>

</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { 
  getFirestore, 
  collection, 
  addDoc, 
  deleteDoc, 
  onSnapshot, 
  doc,
  enableIndexedDbPersistence
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDOIEqttkf43bV61HLpbDDYt7yr92I13Zg",
  authDomain: "ecoactionibaba.firebaseapp.com",
  projectId: "ecoactionibaba",
  storageBucket: "ecoactionibaba.firebasestorage.app",
  messagingSenderId: "367012227040",
  appId: "1:367012227040:web:3b7c517cba2b6ee4c0ad85"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

enableIndexedDbPersistence(db).catch(() => {});

const table = document.getElementById("volunteerTable");
const form = document.getElementById("signupForm");
const inputName = document.getElementById("name");
const inputContact = document.getElementById("contact");
const inputAvailability = document.getElementById("availability");

/* MAP */
const map = L.map('map').setView([13.9360, 120.9250], 15);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

/* VOLUNTEERS */
onSnapshot(collection(db, "volunteers"), snapshot => {
  table.innerHTML = `<tr><th>Name</th><th>Contact</th><th>Availability</th><th>Action</th></tr>`;
  snapshot.forEach(docSnap => addRow(docSnap));
});

form.addEventListener("submit", async e => {
  e.preventDefault();

  await addDoc(collection(db, "volunteers"), {
    name: inputName.value,
    contact: inputContact.value,
    availability: inputAvailability.value,
    created: Date.now()
  });

  form.reset();
});

function addRow(docSnap) {
  const v = docSnap.data();
  const r = table.insertRow();
  r.insertCell().innerText = v.name;
  r.insertCell().innerText = v.contact;
  r.insertCell().innerText = v.availability;

  const c = r.insertCell();
  const b = document.createElement("button");
  b.innerText = "Delete";
  b.onclick = () => deleteDoc(doc(db, "volunteers", docSnap.id));
  c.appendChild(b);
}
</script>

</body>
</html>
